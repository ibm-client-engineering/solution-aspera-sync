"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[993],{4137:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>f});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=n.createContext({}),p=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(i.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(a),m=r,f=c["".concat(i,".").concat(m)]||c[m]||d[m]||o;return a?n.createElement(f,l(l({ref:t},u),{},{components:a})):n.createElement(f,l({ref:t},u))}));function f(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,l=new Array(o);l[0]=m;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[c]="string"==typeof e?e:r,l[1]=s;for(var p=2;p<o;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},1628:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var n=a(7462),r=(a(7294),a(4137));const o={id:"solution-deploy",sidebar_position:2,title:"Deploy"},l="Deploy",s={unversionedId:"Create/solution-deploy",id:"Create/solution-deploy",title:"Deploy",description:"Manually deploy to learn. Automatically deploy to scale.",source:"@site/docs/3-Create/Deploy.md",sourceDirName:"3-Create",slug:"/Create/solution-deploy",permalink:"/solution-aspera-sync/Create/solution-deploy",draft:!1,editUrl:"https://github.com/ibm-client-engineering/solution-aspera-sync/tree/main/packages/create-docusaurus/templates/shared/docs/3-Create/Deploy.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"solution-deploy",sidebar_position:2,title:"Deploy"},sidebar:"tutorialSidebar",previous:{title:"Prepare",permalink:"/solution-aspera-sync/Create/solution-prepare"},next:{title:"Validate",permalink:"/solution-aspera-sync/Create/solution-validate"}},i={},p=[{value:"Manual Deployment",id:"manual-deployment",level:2},{value:"Install HSTS",id:"install-hsts",level:3},{value:"Configure Aspera License",id:"configure-aspera-license",level:3},{value:"Services Configuration",id:"services-configuration",level:3},{value:"Firewall Configuration",id:"firewall-configuration",level:3},{value:"SSH Configuration",id:"ssh-configuration",level:3},{value:"User Configuration",id:"user-configuration",level:3},{value:"Create user <code>asperauser</code>",id:"create-user-asperauser",level:4},{value:"Aspera Configuration",id:"aspera-configuration",level:3},{value:"Aspera Sync",id:"aspera-sync",level:3},{value:"Automated Deployment via Ansible",id:"automated-deployment-via-ansible",level:2},{value:"Hosts validation",id:"hosts-validation",level:4},{value:"Running the playbook",id:"running-the-playbook",level:3},{value:"Before running the playbook, complete the following",id:"before-running-the-playbook-complete-the-following",level:4}],u={toc:p},c="wrapper";function d(e){let{components:t,...a}=e;return(0,r.kt)(c,(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"deploy"},"Deploy"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("strong",{parentName:"p"}," Manually deploy to learn. Automatically deploy to scale."))),(0,r.kt)("h2",{id:"manual-deployment"},"Manual Deployment"),(0,r.kt)("p",null,"The following steps are meant to be followed on both servers. The following will be targeted to ubuntu servers."),(0,r.kt)("h3",{id:"install-hsts"},"Install HSTS"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Summary: Install Aspera HSTS from link below. Once installed, copy the binaries over to the hosts machines to be run and get Aspera installed.\n")),(0,r.kt)("p",null,"Download Aspera High Speed Transfer Server (HSTS) binary ",(0,r.kt)("a",{parentName:"p",href:"https://www.ibm.com/support/fixcentral/swg/selectFixes?parent=ibm~Other%20software&product=ibm/Other%20software/IBM%20Aspera%20High-Speed%20Transfer%20Server&release=All&platform=All&function=all"},"here")),(0,r.kt)("p",null,"Copy the following binary over to your two host machines via ",(0,r.kt)("inlineCode",{parentName:"p"},"scp"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"scp -i {vmHosts.pem} ibm-aspera-hsts-4.4.2.550-linux-64-release.deb {hostUsername}@{hostIpAddress}:/tmp\n")),(0,r.kt)("p",null,"Install the binary by running the following in the ",(0,r.kt)("inlineCode",{parentName:"p"},"/tmp")," directory."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"dpkg -i ibm-aspera-hsts-4.4.2.550-linux-64-release.deb\n")),(0,r.kt)("h3",{id:"configure-aspera-license"},"Configure Aspera License"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Summary: Download your aspera license and transfer over to the hosts.\n")),(0,r.kt)("p",null,"Run the following to transfer your aspera license over"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"scp -i {vmHosts.pem} aspera-license {hostUsername}@{hostIpAddress}:/opt/aspera/etc/aspera-license\n")),(0,r.kt)("p",null,"To verify your license key, run the following command"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"ascp -A\n")),(0,r.kt)("h3",{id:"services-configuration"},"Services Configuration"),(0,r.kt)("p",null,"Enable the following services for Watch Folders. The following command is provided below."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"systemctl enable systemd-networkd\nsystemctl enable systemd-networkd-wait-online.service\n")),(0,r.kt)("h3",{id:"firewall-configuration"},"Firewall Configuration"),(0,r.kt)("p",null,"Port ",(0,r.kt)("inlineCode",{parentName:"p"},"33001")," must be opened for Aspera to run. You can open it by running the following below."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"ufw enable # enables ufw\nufw allow 22/tcp # ssh port\nufw allow 33001/tcp\nufw allow 33001/udp\n")),(0,r.kt)("h3",{id:"ssh-configuration"},"SSH Configuration"),(0,r.kt)("p",null,"To keep this minimal, we will be using password authentication for aspera sync. Thus ",(0,r.kt)("inlineCode",{parentName:"p"},"PasswordAuthentication")," must be set to ",(0,r.kt)("inlineCode",{parentName:"p"},"yes")," and to allow port ",(0,r.kt)("inlineCode",{parentName:"p"},"33001")," act as an ssh medium. Make sure the following exists in ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/ssh/sshd_config")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Port 33001\nPasswordAuthenticaiton yes\n")),(0,r.kt)("p",null,"Make sure to restart SSH service once done by running"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"systemctl restart sshd.service\n")),(0,r.kt)("h3",{id:"user-configuration"},"User Configuration"),(0,r.kt)("p",null,"For Aspera to work, we will need a transfer user. To simplify it, we will create a user called ",(0,r.kt)("inlineCode",{parentName:"p"},"asperauser")," and make him into a transfer user in the next following step."),(0,r.kt)("h4",{id:"create-user-asperauser"},"Create user ",(0,r.kt)("inlineCode",{parentName:"h4"},"asperauser")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"adduser asperauser\n")),(0,r.kt)("p",null,"Create 3 folders in asperauser's directory shown below. ",(0,r.kt)("inlineCode",{parentName:"p"},"asperacontent")," folder will be used to sync between the two servers."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"mkdir /home/asperauser/{asperaContent,asperaSyncLogs,asperaSyncDbdir}\n")),(0,r.kt)("h3",{id:"aspera-configuration"},"Aspera Configuration"),(0,r.kt)("p",null,"Run the following to configure Aspera Sync."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'asconfigurator -x "set_user;username,asperauser,absolute,/home/asperauser/asperaContent"\nasconfigurator -x "set_user;username,asperauser,read_allowed,true"\nasconfigurator -x "set_user;username,asperauser,write_allowed,true"\nasconfigurator -x "set_user;username,asperauser,dir_allowed,true"\nasconfigurator -x "set_user;username,asperauser,authorization_transfer_in_value,allow"\nasconfigurator -x "set_user;username,asperauser,authorization_transfer_out_value,allow"\nasconfigurator -x "set_user;username,asperauser,async_log_dir,/home/asperauser/asperaSyncLogs"\nasconfigurator -x "set_user;username,asperauser,async_db_dir,/home/asperauser/asperaSyncDbdir"\n\n')),(0,r.kt)("p",null,"Make sure to restart aspera by running the following"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"systemctl restart asperanoded\nsystemctl restart asperacentral\n")),(0,r.kt)("h3",{id:"aspera-sync"},"Aspera Sync"),(0,r.kt)("p",null,"To start the sync between both servers, run the following command on one of the server and target it to the other server by running the following"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"async -N asperaSync -d /home/asperauser/asperaContent -r {otherServerUsername}@{otherServerIpaddress}:/ -l 100M -a fair -g 1M -G 1M -C -K BIDI\n")),(0,r.kt)("p",null,"You are able to read more of async commands by clicking ",(0,r.kt)("a",{parentName:"p",href:"https://www.ibm.com/docs/en/ahts/4.4?topic=async-command-reference"},"here")),(0,r.kt)("h2",{id:"automated-deployment-via-ansible"},"Automated Deployment via Ansible"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Ensure that the inventory file is properly configured for your environment")),(0,r.kt)("h4",{id:"hosts-validation"},"Hosts validation"),(0,r.kt)("p",null,"You can verify that you can reach your host by running the following command inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"/resources/ansible")," directory."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"ansible all -m ping\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Do not proceed till you are able to verfiy the hosts")),(0,r.kt)("h3",{id:"running-the-playbook"},"Running the playbook"),(0,r.kt)("h4",{id:"before-running-the-playbook-complete-the-following"},"Before running the playbook, complete the following"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Place ",(0,r.kt)("inlineCode",{parentName:"li"},"ibm-aspera-hsts-*.deb")," inside /resources/ansible/roles/install-aspera/files directory"),(0,r.kt)("li",{parentName:"ul"},"Place 2 Aspera license inside /resources/ansible/roles/configure-aspera/files directory",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"AsperaEnterprise-license-primary")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"AsperaEnterprise-license-secondary"))))),(0,r.kt)("p",null,"You can run the playbook by running the following. The playbook should take an average of 4 mintues"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"ansible-playbook playbook.yml\n")))}d.isMDXComponent=!0}}]);